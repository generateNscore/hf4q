"var argsFromMain=null;\nfunction init(prms) {argsFromMain=prms;}\n//init();\n\nif (argsFromMain == null) {argsFromMain=[[500, 1400], [15, 1], ['x', '8', '\u00f7', '3', '=', '6'], 'shuffle'];}\n//if (argsFromMain == null) {argsFromMain=[[500, 1400], [6, 1], ['x', '8', '\u00f7', '3', '=', '6'], 'null'];}\n[cnvs.height, cnvs.width]=argsFromMain[0];\nvar cw = cnvs.width, ch = cnvs.height, cells=[];\nconst cellW=50, hafW=cellW/2, [cols, rows]=argsFromMain[1];\n//cnvs.height=Math.max(10, rows)*50+40; ch=cnvs.height;\ncnvs.height=(rows+1)*cellW; ch=cnvs.height;\nctx.clearRect(0,0,cw,ch);\n\nconst yTop=20.5, xLeft=20.5;\nconst eqn = argsFromMain[2];\nconst shuffling = argsFromMain[3];\nvar pxX, pxY, bbox, dragging=false, clickedChar=null;\nvar canvasImage;\n\nvar clickedValue=null;\nvar inside;\n\n//console.log(argsFromMain);\n\nconst SubmitBtn={x:(cols+2)*cellW, y:40, w:140, h:50, color:\"#d7d\"};\n\n/*\nfunction getRandomInt(min, max) {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min) + min);\n}\nvar arr = [], r4arr=[];\nif (shuffling == 'shuffle') {\n  var j=0, cr, c, r;\n  while(arr.length < eqn.length){\n    cr = getRandomInt(0, cols*rows);\n    if (r4arr.indexOf(cr) == -1) {\n      c = cr%cols; r = Math.floor((cr-c)/cols);\n      //arr.push({c: eqn[j], n: cr, color:\"black\"});\n      arr.push({c: eqn[j], n: cr, color:\"black\", x:c*cellW+xLeft, y:r*cellW+yTop});\n      r4arr.push(cr);\n      j += 1;\n    }\n  }\n}\nelse {\n  for (let j=0; j<eqn.length; j++) {\n    //arr.push({c: eqn[j], n:j});\n    arr.push({c: eqn[j], n: j, color:\"black\", x:j*cellW+xLeft, y:yTop});\n  }\n}\n*/\n\nvar arr;\nif (typeof answers[Qnumber] ===\"object\" && answers[Qnumber] != null && answers[Qnumber].hasOwnProperty(\"figure\") && answers[Qnumber].hasOwnProperty(\"prm\")) {\n arr=answers[Qnumber].prm;\n}\nelse {\n  arr = [];\n  for (let j=0; j<eqn.length; j++) {arr.push({c: eqn[j], n: j, color:\"black\", x:j*cellW+xLeft, y:yTop});}\n}\n\nfunction drawBackground() {\n  ctx.clearRect(0,0,cw,ch);\n\n  ctx.strokeStyle = \"#eee\";\n  var yBottom=yTop+rows*cellW, x, y;\n  for (let j=0; j<=cols; j++) {\n    ctx.beginPath();\n    x=xLeft+j*cellW;\n    ctx.moveTo(x, yTop);\n    ctx.lineTo(x, yBottom);\n    ctx.stroke();\n  }\n  var xRight=xLeft+cols*cellW\n  for (let j=0; j<=rows; j++) {\n    ctx.beginPath();\n    y = yTop+j*cellW;\n    ctx.moveTo(xLeft, y);\n    ctx.lineTo(xRight, y);\n    ctx.stroke();\n  }\n\n  if (shuffling == 'shuffle') {\n    ctx.beginPath();\n    ctx.shadowColor = \"black\";\n    ctx.shadowOffsetX = 1;\n    ctx.shadowOffsetY = 1;\n    ctx.shadowBlur = 3;\n    ctx.fillStyle=SubmitBtn.color;\n    ctx.fillRect(SubmitBtn.x-SubmitBtn.w/2,SubmitBtn.y-SubmitBtn.h/2,SubmitBtn.w,SubmitBtn.h);\n    ctx.shadowColor = \"transparent\";\n    ctx.fillStyle=\"black\"; ctx.font = \"28px arial\"; ctx.textAlign=\"center\"; \n    ctx.fillText(\"Submit\", SubmitBtn.x, SubmitBtn.y+10);\n    ctx.closePath();\n  }\n\n  canvasImage=ctx.getImageData(0,0,cw,ch);\n}\n\ndrawBackground();\n\n\nfunction trim(x) {\n  return x.replace(/^\\s+|\\s+$/gm, '');\n}\n\nfunction Submit() {\n  var ans=\"\";\n  var flag;\n  for (let n=0; n<cols*rows; n++) {\n    flag=null;\n    for (let j=0; j<arr.length; j++) {\n      if (arr[j].n == n) {\n        flag=j;\n        break;\n      }\n    }\n    if (flag == null) {ans += ' ';}\n    else {ans += arr[flag].c;}\n  }\n  answers[Qnumber]=\"'\"+trim(ans)+\"'\";\n  addAnswers2Textarea();\n}\n\nif (shuffling == 'shuffle') {\n  cnvs.addEventListener('mouseup', onmouseup);\n  cnvs.addEventListener('mousedown', onmousedown);\n  cnvs.addEventListener('mousemove', onmousemove);\n}\n\nfunction onmousedown(e) {\n  e.preventDefault();\n  bbox = cnvs.getBoundingClientRect();\n  pxX=e.clientX-bbox.left*(cw/bbox.width);\n  pxY=e.clientY-bbox.top*(ch/bbox.height);\n\n  if (SubmitBtn.x-SubmitBtn.w/2<=pxX && pxX <= SubmitBtn.x+SubmitBtn.w/2 && SubmitBtn.y-SubmitBtn.h/2<=pxY && pxY <= SubmitBtn.y+SubmitBtn.h/2) {Submit();}\n\n  for (let j=0; j<arr.length; j++) {\n    if (amIinside(arr[j], pxX, pxY)) {\n        dragging=true;\n        clickedChar=j;\n        arr[clickedChar].color=\"#f00\";\n        break;\n    }\n  }\n\n}\n\nfunction onmouseup(e) {\n  e.preventDefault();\n  bbox = cnvs.getBoundingClientRect();\n  pxX=e.clientX-bbox.left*(cw/bbox.width);\n  pxY=e.clientY-bbox.top*(ch/bbox.height);\n\n  if (dragging == true) {\n    arr[clickedChar].color=\"black\";\n    drawAll();\n    clickedChar=null;\n    dragging=false;\n  }\n}\n\nfunction amIinside(it, x, y) {\n  if (it.x+10 < x && x < it.x+cellW-10 && it.y+10 < y && y < it.y+cellW-10) return true;\n  else return false;\n}\n\n\nfunction onmousemove(e) {\n  e.preventDefault();\n  bbox = cnvs.getBoundingClientRect();\n  pxX=e.clientX-bbox.left*(cw/bbox.width);\n  pxY=e.clientY-bbox.top*(ch/bbox.height);\n\n  if (dragging) {\n    const [row, col] = pxl2RowCol(pxX, pxY);\n    arr[clickedChar].n=col+row*cols;\n    arr[clickedChar].x=col*cellW+xLeft;\n    arr[clickedChar].y=row*cellW+yTop;\n    drawAll();\n  }\n  else {\n    for (let j=0; j<arr.length; j++) {\n      if (amIinside(arr[j], pxX, pxY)) {\n        arr[j].color = \"red\";\n        drawAll();\n        break;\n      }\n      else {\n        if (arr[j].color == \"red\") {\n          arr[j].color=\"black\";\n          drawAll();\n        }\n      }\n    }\n  }\n}\n\nfunction pxl2RowCol(x, y) {\n  return [Math.floor((y-yTop)/cellW), Math.floor((x-xLeft)/cellW)];\n}\n\nfunction getValue() {\n  let col=Math.floor((pxX-20)/cellW);\n  let row=Math.floor((pxY-20)/cellW);\n  return col+row*cols;\n}\n\nfunction drawAll() {\n  ctx.putImageData(canvasImage,0,0);\n\n  ctx.font = \"36px arial\"; ctx.textAlign=\"center\";\n  for (let j=0; j<arr.length; j++) {\n    ctx.beginPath(); ctx.fillStyle=arr[j].color;\n    ctx.fillText(arr[j].c, arr[j].x+hafW, arr[j].y+40);\n  }\n/*\n  ctx.font = \"16px arial\"; ctx.textAlign=\"center\";\n  for (let j=0; j<arr.length; j++) {\n    //Rem = arr[j].n%cols; Quo = Math.floor((arr[j].n-Rem)/cols);\n    ctx.beginPath(); ctx.fillStyle=arr[j].color;\n    ctx.fillText(arr[j].n, arr[j].x+hafW, 15);\n  }\n*/\n  answers[Qnumber]={figure:\"yes\", prm: arr};\n}\n\ndrawAll();"